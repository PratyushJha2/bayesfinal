library(tidyverse)
library(rstan)
library(rstanarm)
library(bayesplot)
base_url <- "https://exoplanetarchive.ipac.caltech.edu/TAP/sync"
query_string <- "select+pl_name,disc_year,pl_rade,pl_orbper,st_met,st_teff,discoverymethod+from+ps+where+default_flag=1&format=csv"
full_url <- paste0(base_url, "?query=", query_string)
raw_planets <- read_csv(full_url)
clean_data <- raw_planets %>%
  mutate(
    log_radius = log(pl_rade),
    log_period = log(pl_orbper),
    st_teff_k = st_teff / 1000
  ) %>%
  filter(
    !is.na(disc_year),
    !is.na(log_radius),
    !is.na(log_period),
    !is.na(st_met),
    !is.na(st_teff_k),
    !is.na(discoverymethod)
  )
yearly_counts <- clean_data %>%
  count(disc_year) %>%
  rename(n_planets = n)
head(yearly_counts)
q()
poisson_stan_code <- "
data {
  int<lower=0> N;
  int<lower=0> y[N];
}
parameters {
  real<lower=0> lambda;
}
model {
  lambda ~ gamma(2, 0.1);
  y ~ poisson(lambda);
}
"
stan_data <- list(
  N = nrow(yearly_counts),
  y = yearly_counts$n_planets
)
poisson_fit <- stan(
  model_code = poisson_stan_code,
  data = stan_data,
  iter = 2000,
  chains = 4
)
library(tidyverse)
library(rstan)
library(rstanarm)
library(bayesplot)
base_url <- "https://exoplanetarchive.ipac.caltech.edu/TAP/sync"
query_string <- "select+pl_name,disc_year,pl_rade,pl_orbper,st_met,st_teff,discoverymethod+from+ps+where+default_flag=1&format=csv"
full_url <- paste0(base_url, "?query=", query_string)
raw_planets <- read_csv(full_url)
clean_data <- raw_planets %>%
  mutate(
    log_radius = log(pl_rade),
    log_period = log(pl_orbper),
    st_teff_k = st_teff / 1000
  ) %>%
  filter(
    !is.na(disc_year),
    !is.na(log_radius),
    !is.na(log_period),
    !is.na(st_met),
    !is.na(st_teff_k),
    !is.na(discoverymethod)
  )
yearly_counts <- clean_data %>%
  count(disc_year) %>%
  rename(n_planets = n)
head(yearly_counts)
poisson_stan_code <- "
data {
  int<lower=0> N;
  int<lower=0> y[N];
}
parameters {
  real<lower=0> lambda;
}
model {
  lambda ~ gamma(2, 0.1);
  y ~ poisson(lambda);
}
"
stan_data <- list(
  N = nrow(yearly_counts),
  y = yearly_counts$n_planets
)
poisson_fit <- stan(
  model_code = poisson_stan_code,
  data = stan_data,
  iter = 2000,
  chains = 4
)
git add .
q()
