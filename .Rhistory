library(tidyverse)
library(rstan)
library(rstanarm)
library(bayesplot)
base_url <- "https://exoplanetarchive.ipac.caltech.edu/TAP/sync"
query_string <- "select+pl_name,disc_year,pl_rade,pl_orbper,st_met,st_teff,discoverymethod+from+ps+where+default_flag=1&format=csv"
full_url <- paste0(base_url, "?query=", query_string)
raw_planets <- read_csv(full_url)
clean_data <- raw_planets %>%
  mutate(
    log_radius = log(pl_rade),
    log_period = log(pl_orbper),
    st_teff_k = st_teff / 1000
  ) %>%
  filter(
    !is.na(disc_year),
    !is.na(log_radius),
    !is.na(log_period),
    !is.na(st_met),
    !is.na(st_teff_k),
    !is.na(discoverymethod)
  )
yearly_counts <- clean_data %>%
  count(disc_year) %>%
  rename(n_planets = n)
head(yearly_counts)
q()
